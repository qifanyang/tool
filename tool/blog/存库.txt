存库策略

//开启一个Timer,每一秒遍历当前地图所有玩家,如果该玩家数据在cache中

BackPackTimer每秒不停的忘WaitingUpdateQueue中放入玩家对象,里面用一个ConcurrentHashSet保证数据不重复,用ConcurrentLinkedQueue保存对象,实现先进先出,生产者

再使用一个Timer,SaveThread每间隔5秒从里面取出一定数量上面放入WaitingUpdateQueue的玩家(需要设计取出数量的策略),更改身上的save状态为true,消费者

PlayerHeartTimer每秒检查玩家身上的save状态,如果需要保存,则新建一个存库对象并放入存库线程中存库,然后再更改save标识为false


还可以简单处理,定时直接保存,不使用上面的策略,当在线玩家很多时,可能一下次存储几千人的数据,对数据库的压力很大.


使用定时更改标志位的方式,写代码时可以不再手动去设置标志位,以前遇到过更改数据后需要手动更改标志位,有时候忘记更改了,则数据无法存库,一直等到关服的时候全部统一
存库才有机会把更改的数据存库,如果中途服务器宕机,则数据就丢失了